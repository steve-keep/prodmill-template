name: Initialize Project

on:
  push:
    branches:
      - main

jobs:
  init:
    runs-on: ubuntu-latest
    if: github.actor != 'github-actions[bot]'
    permissions:
      contents: write
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Install uv
        run: curl -LsSf https://astral.sh/uv/install.sh | sh

      - name: Install tools
        run: |
          chmod +x setup.sh
          ./setup.sh

      - name: Run init commands
        run: |
          export PATH="$HOME/.local/bin:$HOME/.beads/bin:$PATH"
          specify init gemini --ai gemini --ignore-agent-tools --script sh
          bd init

      - name: Commit files
        run: |
          git config --global user.name 'github-actions[bot]'
          git config --global user.email 'github-actions[bot]@users.noreply.github.com'
          git add .
          git commit -m "Initialize project" || echo "No changes to commit"
          git push

      - name: Self-destruct workflow
        run: |
          git rm .github/workflows/init.yml
          git commit -m "Remove initialization workflow"
          git push
